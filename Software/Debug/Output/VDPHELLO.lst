              	; --------------------------------------
              	; zasm: assemble "VDPHELLO.asm"
              	; date: 2024-09-26 23:40:30
              	; --------------------------------------


              	;
              	;**************************************************************
              	;*
              	;*               V D P   H E L L O   P R O G R A M
              	;*
              	;*    The VDP says hello! Expects VDP to be setup for CP/M
              	;*    console mode.
              	;*
              	;*    Should be run in the MSX virtual machine
              	;* 
              	;**************************************************************
              	
0098:         	nabu_vdp_data	equ	0x98	; VDP Data Port
0099:         	nabu_vdp_addr	equ	0x99 	; VDP Address Port
00A0:         	nabu_ay_addr	equ	0xA0	; PSG Address
00A1:         	nabu_ay_data	equ	0xA1	; PSG Data
              	
C000:         	draw_buffer	equ	0xC000
              	
              	
              	; Program start
0000:         		org	0x0000
              		
              		; Do stuff with the VDP
0000:         	start:	
0000: 3E50    		ld	a,0x50
0002: D3A8    		out	(0xA8),a
0004: 3E42    		ld	a,0x42
0006: 013412  		ld	bc,0x1234
0009: 24      		inc	h
000A: 2C      		inc	l
000B: F3      		di
000C: 0669    		ld	b,0x69
000E: D3FF    		out	(0xFF),a
0010: 3C      		inc	a
0011: 04      		inc	b
0012: 0C      		inc	c
0013: 14      		inc	d
0014: 1C      		inc	e
0015: 24      		inc	h
0016: 2C      		inc	l
0017: 31FFFF  		ld	sp,0xFFFF
              		
              		; Move tms_hello to the draw buffer
001A: 21DF00  		ld	hl,tms_hello
001D: 1100C0  		ld	de,draw_buffer
0020: 01C003  		ld	bc,40*24
0023: EDB0    		ldir
              		
              		; Draw a little pattern
0025: 21F0C0  		ld	hl,draw_buffer+(tms_foobar-tms_hello)
0028: AF      		xor	a
0029: 77      	69$:	ld	(hl),a
002A: 23      		inc	hl
002B: 3C      		inc	a
002C: C22900  		jp	nz,69$
              		
              	
002F:         	dowrite:	
              		; Grab key matrix values
002F: 3E00    		ld	a,0x00
0031: D3AA    		out	(0xAA),a
0033: DBA9    		in	a,(0xA9)
0035: CDBF00  		call	tohex
0038: ED5328C0		ld	(0xC000 + (40*1)),de
003C: 3E01    		ld	a,0x01
003E: D3AA    		out	(0xAA),a
0040: DBA9    		in	a,(0xA9)
0042: CDBF00  		call	tohex
0045: ED5350C0		ld	(0xC000 + (40*2)),de
0049: 3E02    		ld	a,0x02
004B: D3AA    		out	(0xAA),a
004D: DBA9    		in	a,(0xA9)
004F: CDBF00  		call	tohex
0052: ED5378C0		ld	(0xC000 + (40*3)),de
0056: 3E03    		ld	a,0x03
0058: D3AA    		out	(0xAA),a
005A: DBA9    		in	a,(0xA9)
005C: CDBF00  		call	tohex
005F: ED53A0C0		ld	(0xC000 + (40*4)),de
0063: 3E04    		ld	a,0x04
0065: D3AA    		out	(0xAA),a
0067: DBA9    		in	a,(0xA9)
0069: CDBF00  		call	tohex
006C: ED53C8C0		ld	(0xC000 + (40*5)),de
0070: 3E05    		ld	a,0x05
0072: D3AA    		out	(0xAA),a
0074: DBA9    		in	a,(0xA9)
0076: CDBF00  		call	tohex
0079: ED53F0C0		ld	(0xC000 + (40*6)),de
007D: 3E06    		ld	a,0x06
007F: D3AA    		out	(0xAA),a
0081: DBA9    		in	a,(0xA9)
0083: CDBF00  		call	tohex
0086: ED5318C1		ld	(0xC000 + (40*7)),de
008A: 3E07    		ld	a,0x07
008C: D3AA    		out	(0xAA),a
008E: DBA9    		in	a,(0xA9)
0090: CDBF00  		call	tohex
0093: ED5340C1		ld	(0xC000 + (40*8)),de
0097: 3E08    		ld	a,0x08
0099: D3AA    		out	(0xAA),a
009B: DBA9    		in	a,(0xA9)
009D: CDBF00  		call	tohex
00A0: ED5368C1		ld	(0xC000 + (40*9)),de
              	
              	
              		; Set up write address
00A4: 010048  		ld	bc,0x4800
00A7: CDD600  		call	tms_addr
              		
              		; Write it in!
00AA: 2100C0  		ld	hl,draw_buffer
00AD: 01C003  		ld	bc,24*40
00B0: 7E      	0$:	ld	a,(hl)
00B1: D398    		out	(nabu_vdp_data),a
00B3: F5      		push	af
00B4: F1      		pop	af
00B5: 0B      		dec	bc
00B6: 23      		inc	hl
00B7: 78      		ld	a,b
00B8: B1      		or	c
00B9: C2B000  		jp	nz,0$
00BC: C32F00  		jp	dowrite
              	
              	
              	; ----------------------
              	; ******** Misc ********
              	; ----------------------
              		
              	; Converts the value into an 8 bit hex number
              	; A = Number to convert
              	;
              	; Returns DE = result
              	; Uses: AF, DE
00BF: 57      	tohex:	ld	d,a
00C0: CDCA00  		call	0$
00C3: 5F      		ld	e,a
00C4: 7A      		ld	a,d
00C5: CDCE00  		call	1$
00C8: 57      		ld	d,a
00C9: C9      		ret
              		
00CA: 1F      	0$:	rra
00CB: 1F      		rra
00CC: 1F      		rra
00CD: 1F      		rra
00CE: F6F0    	1$:	or	0xF0
00D0: 27      		daa
00D1: C6A0    		add	a,0xA0
00D3: CE40    		adc	a,0x40
00D5: C9      		ret
              	
              	
              	
00D6:         	tms_addr:
00D6: DB99    		in	a,(nabu_vdp_addr)
00D8: 79      		ld	a,c
00D9: D399    		out	(nabu_vdp_addr),a
00DB: 78      		ld	a,b
00DC: D399    		out	(nabu_vdp_addr),a
00DE: C9      		ret
              		
              	
              	; Hello message	
00DF:         	tms_hello:
00DF: 48454C4C		defb	'H','E','L','L','O','!',0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
00E3: 4F212020	
00E7: 20202020	
00EB: 20...   	
0107: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
010B: 20...   	
012F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0133: 20...   	
0157: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
015B: 20...   	
017F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0183: 20...   	
01A7: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
01AB: 20...   	
01CF:         	tms_foobar:
01CF: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
01D3: 20...   	
01F7: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
01FB: 20...   	
021F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0223: 20...   	
0247: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
024B: 20...   	
026F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0273: 20...   	
0297: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
029B: 20...   	
02BF: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
02C3: 20...   	
02E7: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
02EB: 20...   	
030F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0313: 20...   	
0337: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
033B: 20...   	
035F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0363: 20...   	
0387: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
038B: 20...   	
03AF: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
03B3: 20...   	
03D7: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
03DB: 20...   	
03FF: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0403: 20...   	
0427: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
042B: 20...   	
044F: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0453: 20...   	
0477: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,':','3'
047B: 20202020	
047F: 20202020	
0483: 20202020	
0487: 20202020	
048B: 20202020	
048F: 20202020	
0493: 20202020	
0497: 20202020	
049B: 20203A33	
              		
              		
              	;	.org	0x7000
              	;	ld	a,0x42
              	;	ld	bc,0x1234
              	;	inc	h
              	;	inc	l
              	;	di
              	;	ld	b,0x69
              	;	out	(0xFF),a
              	;	inc	a
              	;	inc	b
              	;	inc	c
              	;	inc	d
              	;	inc	e
              	;	inc	h
              	;	inc	l
              	;	ld	sp,0xB004


; +++ segments +++

#CODE          = $0000 =     0,  size = $049F =  1183

; +++ global symbols +++

_end          = $049F =  1183          VDPHELLO.asm:22 (unused)
_size         = $049F =  1183          VDPHELLO.asm:22 (unused)
dowrite       = $002F =    47          VDPHELLO.asm:59
draw_buffer   = $C000 = 49152          VDPHELLO.asm:18
nabu_ay_addr  = $00A0 =   160          VDPHELLO.asm:15 (unused)
nabu_ay_data  = $00A1 =   161          VDPHELLO.asm:16 (unused)
nabu_vdp_addr = $0099 =   153          VDPHELLO.asm:14
nabu_vdp_data = $0098 =   152          VDPHELLO.asm:13
start         = $0000 =     0          VDPHELLO.asm:25 (unused)
tms_addr      = $00D6 =   214          VDPHELLO.asm:156
tms_foobar    = $01CF =   463          VDPHELLO.asm:173
tms_hello     = $00DF =   223          VDPHELLO.asm:166
tohex         = $00BF =   191          VDPHELLO.asm:136


total time: 0.0503 sec.
no errors
