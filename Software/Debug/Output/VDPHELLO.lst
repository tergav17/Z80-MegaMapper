              	; --------------------------------------
              	; zasm: assemble "VDPHELLO.asm"
              	; date: 2024-09-02 22:36:29
              	; --------------------------------------


              	;
              	;**************************************************************
              	;*
              	;*               V D P   H E L L O   P R O G R A M
              	;*
              	;*    The VDP says hello! Expects VDP to be setup for CP/M
              	;*    console mode.
              	;*
              	;*    Should be run in the KSG1000 virtual machine
              	;* 
              	;**************************************************************
              	
00BE:         	nabu_vdp_data	equ	0xBE	; VDP Data Port
00BF:         	nabu_vdp_addr	equ	0xBF	; VDP Address Port
              	
C000:         	draw_buffer	equ	0xC000
              	
              	
              	; Program start
0000:         		org	0x0000
              		
              		; Do stuff with the VDP
0000:         	start:	
0000: 3E42    		ld	a,0x42
0002: 013412  		ld	bc,0x1234
0005: 24      		inc	h
0006: 2C      		inc	l
0007: F3      		di
0008: 0669    		ld	b,0x69
000A: D3FF    		out	(0xFF),a
000C: 3C      		inc	a
000D: 04      		inc	b
000E: 0C      		inc	c
000F: 14      		inc	d
0010: 1C      		inc	e
0011: 24      		inc	h
0012: 2C      		inc	l
0013: 31FFFF  		ld	sp,0xFFFF
              		
              		; Move tms_hello to the draw buffer
0016: 218100  		ld	hl,tms_hello
0019: 1100C0  		ld	de,draw_buffer
001C: 01C003  		ld	bc,40*24
001F: EDB0    		ldir
              		
              		; Draw a little pattern
0021: 21F0C0  		ld	hl,draw_buffer+(tms_foobar-tms_hello)
0024: AF      		xor	a
0025: 77      	69$:	ld	(hl),a
0026: 23      		inc	hl
0027: 3C      		inc	a
0028: C22500  		jp	nz,69$
              		
              	
002B:         	dowrite:	
              		; Grab the controller values
002B: DBC0    		in	a,(0xC0)
002D: CD6100  		call	tohex
0030: ED5328C0		ld	(0xC000 + 40),de
0034: DBC1    		in	a,(0xC1)
0036: CD6100  		call	tohex
0039: ED5350C0		ld	(0xC000 + 80),de
003D: DB00    		in	a,(0x00)
003F: CD6100  		call	tohex
0042: ED5378C0		ld	(0xC000 + 120),de
              	
              	
              		; Set up write address
0046: 010048  		ld	bc,0x4800
0049: CD7800  		call	tms_addr
              		
              		; Write it in!
004C: 2100C0  		ld	hl,draw_buffer
004F: 01C003  		ld	bc,24*40
0052: 7E      	0$:	ld	a,(hl)
0053: D3BE    		out	(nabu_vdp_data),a
0055: F5      		push	af
0056: F1      		pop	af
0057: 0B      		dec	bc
0058: 23      		inc	hl
0059: 78      		ld	a,b
005A: B1      		or	c
005B: C25200  		jp	nz,0$
005E: C32B00  		jp	dowrite
              	
              	
              	; ----------------------
              	; ******** Misc ********
              	; ----------------------
              		
              	; Converts the value into an 8 bit hex number
              	; A = Number to convert
              	;
              	; Returns DE = result
              	; Uses: AF, DE
0061: 57      	tohex:	ld	d,a
0062: CD6C00  		call	0$
0065: 5F      		ld	e,a
0066: 7A      		ld	a,d
0067: CD7000  		call	1$
006A: 57      		ld	d,a
006B: C9      		ret
              		
006C: 1F      	0$:	rra
006D: 1F      		rra
006E: 1F      		rra
006F: 1F      		rra
0070: F6F0    	1$:	or	0xF0
0072: 27      		daa
0073: C6A0    		add	a,0xA0
0075: CE40    		adc	a,0x40
0077: C9      		ret
              	
              	
              	
0078:         	tms_addr:
0078: DBBF    		in	a,(nabu_vdp_addr)
007A: 79      		ld	a,c
007B: D3BF    		out	(nabu_vdp_addr),a
007D: 78      		ld	a,b
007E: D3BF    		out	(nabu_vdp_addr),a
0080: C9      		ret
              		
              	
              	; Hello message	
0081:         	tms_hello:
0081: 48454C4C		defb	'H','E','L','L','O','!',0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0085: 4F212020	
0089: 20202020	
008D: 20...   	
00A9: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
00AD: 20...   	
00D1: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
00D5: 20...   	
00F9: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
00FD: 20...   	
0121: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0125: 20...   	
0149: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
014D: 20...   	
0171:         	tms_foobar:
0171: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0175: 20...   	
0199: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
019D: 20...   	
01C1: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
01C5: 20...   	
01E9: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
01ED: 20...   	
0211: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0215: 20...   	
0239: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
023D: 20...   	
0261: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0265: 20...   	
0289: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
028D: 20...   	
02B1: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
02B5: 20...   	
02D9: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
02DD: 20...   	
0301: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0305: 20...   	
0329: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
032D: 20...   	
0351: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
0355: 20...   	
0379: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
037D: 20...   	
03A1: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
03A5: 20...   	
03C9: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
03CD: 20...   	
03F1: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
03F5: 20...   	
0419: 20202020		defb	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,':','3'
041D: 20202020	
0421: 20202020	
0425: 20202020	
0429: 20202020	
042D: 20202020	
0431: 20202020	
0435: 20202020	
0439: 20202020	
043D: 20203A33	
              		
              		
              	;	.org	0x7000
              	;	ld	a,0x42
              	;	ld	bc,0x1234
              	;	inc	h
              	;	inc	l
              	;	di
              	;	ld	b,0x69
              	;	out	(0xFF),a
              	;	inc	a
              	;	inc	b
              	;	inc	c
              	;	inc	d
              	;	inc	e
              	;	inc	h
              	;	inc	l
              	;	ld	sp,0xB004


; +++ segments +++

#CODE          = $0000 =     0,  size = $0441 =  1089

; +++ global symbols +++

_end          = $0441 =  1089          VDPHELLO.asm:20 (unused)
_size         = $0441 =  1089          VDPHELLO.asm:20 (unused)
dowrite       = $002B =    43          VDPHELLO.asm:55
draw_buffer   = $C000 = 49152          VDPHELLO.asm:16
nabu_vdp_addr = $00BF =   191          VDPHELLO.asm:14
nabu_vdp_data = $00BE =   190          VDPHELLO.asm:13
start         = $0000 =     0          VDPHELLO.asm:23 (unused)
tms_addr      = $0078 =   120          VDPHELLO.asm:116
tms_foobar    = $0171 =   369          VDPHELLO.asm:133
tms_hello     = $0081 =   129          VDPHELLO.asm:126
tohex         = $0061 =    97          VDPHELLO.asm:96


total time: 0.0020 sec.
no errors
